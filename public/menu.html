<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Caf√© Bliss - Menu & Order</title>
    <link rel="stylesheet" href="style.css">
    <style>
        .order-section {
            margin-top: 40px;
            text-align: center;
        }
        .order-section form {
            max-width: 400px;
            margin: auto;
            background: #fff3e0;
            padding: 15px;
            border-radius: 10px;
        }
        .order-section label {
            font-weight: bold;
            display: block;
            margin-top: 10px;
        }
        .order-section input, .order-section button {
            width: 100%;
            padding: 6px;
            margin-top: 5px;
        }
        .recent-orders {
            margin-top: 40px;
        }
        .recent-orders ul {
            list-style: none;
            padding: 0;
        }
        .recent-orders li {
            background: #f8f8f8;
            margin: 5px auto;
            padding: 8px;
            max-width: 400px;
            border-radius: 8px;
        }
    </style>
</head>
<body>
    <header>
        <h1>Caf√© Bliss</h1>
        <nav>
            <a href="index.html">Home</a>
            <a href="menu.html">Menu</a>
            <a href="contact.html">Contact</a>
        </nav>
    </header>

    <section>
        <h2>‚òï Coffee & Espresso Drinks</h2>
        <div class="item-grid">
            <div onclick="addToOrder('Cold Brew')"><img src="images/brew.jpeg" alt="Cold Brew"><p>Cold Brew - ‚Çπ120</p></div>
            <div onclick="addToOrder('Espresso')"><img src="images/ex.jpeg" alt="Espresso"><p>Espresso - ‚Çπ80</p></div>
            <div onclick="addToOrder('Iced Latte')"><img src="images/icedd.jpeg" alt="Iced Latte"><p>Iced Latte - ‚Çπ150</p></div>
            <div onclick="addToOrder('Cappuccino')"><img src="images/cap.jpeg" alt="Cappuccino"><p>Cappuccino - ‚Çπ140</p></div>
            <div onclick="addToOrder('Hot Chocolate')"><img src="images/hot.jpeg" alt="Hot Chocolate"><p>Hot Chocolate - ‚Çπ130</p></div>
            <div onclick="addToOrder('Chai')"><img src="images/chai.jpeg" alt="Chai"><p>Chai - ‚Çπ90</p></div>
        </div>
    </section>

    <!-- Order Form Section -->
    <section class="order-section">
        <h2>üìù Place Your Order</h2>
        <form id="orderForm">
            <label>Name:</label>
            <input type="text" id="name" required>

            <label>Email:</label>
            <input type="email" id="email" required>

            <label>Items Selected:</label>
            <input type="text" id="selectedItems" readonly>

            <label>Total Price (‚Çπ):</label>
            <input type="number" id="totalPrice" readonly>

            <button type="submit">Submit Order</button>
        </form>
    </section>

    <!-- Recent Orders Section -->
    <section class="recent-orders">
        <h2>üì¶ Recent Orders</h2>
        <ul id="ordersList"></ul>
    </section>

    <footer>
        <p>¬© 2025 Caf√© Bliss</p>
    </footer>

    <script>
        const itemPrices = {
            "Cold Brew": 120,
            "Espresso": 80,
            "Iced Latte": 150,
            "Cappuccino": 140,
            "Hot Chocolate": 130,
            "Chai": 90
        };

        let orderItems = [];
        let totalPrice = 0;

        function addToOrder(item) {
            orderItems.push(item);
            totalPrice += itemPrices[item];
            document.getElementById('selectedItems').value = orderItems.join(', ');
            document.getElementById('totalPrice').value = totalPrice;
        }

        document.getElementById('orderForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            const orderData = {
                name: document.getElementById('name').value.trim(),
                email: document.getElementById('email').value.trim(),
                items: orderItems,
                totalPrice: totalPrice
            };

            try {
                const response = await fetch('/order', { // fixed URL
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(orderData)
                });

                if (!response.ok) throw new Error('Server error');

                alert('‚úÖ Order placed successfully!');
                orderItems = [];
                totalPrice = 0;
                document.getElementById('selectedItems').value = '';
                document.getElementById('totalPrice').value = '';
                document.getElementById('orderForm').reset();
                fetchOrders();
            } catch (err) {
                alert('‚ùå ' + err.message);
            }
        });

        async function fetchOrders() {
            try {
                const res = await fetch('/orders'); // fixed URL
                if (!res.ok) throw new Error('Failed to fetch orders');

                const orders = await res.json();
                const list = document.getElementById('ordersList');
                list.innerHTML = '';
                orders.forEach(o => {
                    const li = document.createElement('li');
                    li.textContent = `${o.name} - ${o.items.join(', ')} - ‚Çπ${o.totalPrice}`;
                    list.appendChild(li);
                });
            } catch (err) {
                console.error('Error fetching orders:', err);
            }
        }

        fetchOrders();
    </script>
</body>
</html>
